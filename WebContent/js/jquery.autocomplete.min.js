(function(a){"use strict";if(typeof define==='function'&&define.amd){define(['jquery'],a)}else if(typeof exports==='object'&&typeof require==='function'){a(require('jquery'))}else{a(jQuery)}}(function($){'use strict';var g=(function(){return{escapeRegExChars:function(a){return a.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")},createNode:function(a){var b=document.createElement('div');b.className=a;b.style.position='absolute';b.style.display='none';return b}}}()),keys={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};function Autocomplete(d,e){var f=$.noop,that=this,defaults={ajaxSettings:{},autoSelectFirst:false,appendTo:document.body,serviceUrl:null,lookup:null,onSelect:null,width:'auto',minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:Autocomplete.formatResult,delimiter:null,zIndex:9999,type:'GET',noCache:false,onSearchStart:f,onSearchComplete:f,onSearchError:f,preserveInput:false,containerClass:'autocomplete-suggestions',tabDisabled:false,dataType:'text',currentRequest:null,triggerSelectOnValidInput:true,preventBadQueries:true,lookupFilter:function(a,b,c){return a.value.toLowerCase().indexOf(c)!==-1},paramName:'query',transformResult:function(a){return typeof a==='string'?$.parseJSON(a):a},showNoSuggestionNotice:false,noSuggestionNotice:'No results',orientation:'bottom',forceFixPosition:false};that.element=d;that.el=$(d);that.suggestions=[];that.badQueries=[];that.selectedIndex=-1;that.currentValue=that.element.value;that.intervalId=0;that.cachedResponse={};that.onChangeInterval=null;that.onChange=null;that.isLocal=false;that.suggestionsContainer=null;that.noSuggestionsContainer=null;that.options=$.extend({},defaults,e);that.classes={selected:'autocomplete-selected',suggestion:'autocomplete-suggestion'};that.hint=null;that.hintValue='';that.selection=null;that.initialize();that.setOptions(e)}Autocomplete.utils=g;$.Autocomplete=Autocomplete;Autocomplete.formatResult=function(a,b){if(!b){return a.value}var c='('+g.escapeRegExChars(b)+')';return a.value.replace(new RegExp(c,'gi'),'<strong>$1<\/strong>').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/&lt;(\/?strong)&gt;/g,'<$1>')};Autocomplete.prototype={killerFn:null,initialize:function(){var a=this,suggestionSelector='.'+a.classes.suggestion,selected=a.classes.selected,options=a.options,container;a.element.setAttribute('autocomplete','off');a.killerFn=function(e){if(!$(e.target).closest('.'+a.options.containerClass).length){a.killSuggestions();a.disableKillerFn()}};a.noSuggestionsContainer=$('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0);a.suggestionsContainer=Autocomplete.utils.createNode(options.containerClass);container=$(a.suggestionsContainer);container.appendTo(options.appendTo);if(options.width!=='auto'){container.css('width',options.width)}container.on('mouseover.autocomplete',suggestionSelector,function(){a.activate($(this).data('index'))});container.on('mouseout.autocomplete',function(){a.selectedIndex=-1;container.children('.'+selected).removeClass(selected)});container.on('click.autocomplete',suggestionSelector,function(){a.select($(this).data('index'));return false});a.fixPositionCapture=function(){if(a.visible){a.fixPosition()}};$(window).on('resize.autocomplete',a.fixPositionCapture);a.el.on('keydown.autocomplete',function(e){a.onKeyPress(e)});a.el.on('keyup.autocomplete',function(e){a.onKeyUp(e)});a.el.on('blur.autocomplete',function(){a.onBlur()});a.el.on('focus.autocomplete',function(){a.onFocus()});a.el.on('change.autocomplete',function(e){a.onKeyUp(e)});a.el.on('input.autocomplete',function(e){a.onKeyUp(e)})},onFocus:function(){var a=this;a.fixPosition();if(a.el.val().length>=a.options.minChars){a.onValueChange()}},onBlur:function(){this.enableKillerFn()},abortAjax:function(){var a=this;if(a.currentRequest){a.currentRequest.abort();a.currentRequest=null}},setOptions:function(a){var b=this,options=b.options;$.extend(options,a);b.isLocal=$.isArray(options.lookup);if(b.isLocal){options.lookup=b.verifySuggestionsFormat(options.lookup)}options.orientation=b.validateOrientation(options.orientation,'bottom');$(b.suggestionsContainer).css({'max-height':options.maxHeight+'px','width':options.width+'px','z-index':options.zIndex})},clearCache:function(){this.cachedResponse={};this.badQueries=[]},clear:function(){this.clearCache();this.currentValue='';this.suggestions=[]},disable:function(){var a=this;a.disabled=true;clearInterval(a.onChangeInterval);a.abortAjax()},enable:function(){this.disabled=false},fixPosition:function(){var a=this,$container=$(a.suggestionsContainer),containerParent=$container.parent().get(0);if(containerParent!==document.body&&!a.options.forceFixPosition){return}var b=a.options.orientation,containerHeight=$container.outerHeight(),height=a.el.outerHeight(),offset=a.el.offset(),styles={'top':offset.top,'left':offset.left};if(b==='auto'){var c=$(window).height(),scrollTop=$(window).scrollTop(),topOverflow=-scrollTop+offset.top-containerHeight,bottomOverflow=scrollTop+c-(offset.top+height+containerHeight);b=(Math.max(topOverflow,bottomOverflow)===topOverflow)?'top':'bottom'}if(b==='top'){styles.top+=-containerHeight}else{styles.top+=height}if(containerParent!==document.body){var d=$container.css('opacity'),parentOffsetDiff;if(!a.visible){$container.css('opacity',0).show()}parentOffsetDiff=$container.offsetParent().offset();styles.top-=parentOffsetDiff.top;styles.left-=parentOffsetDiff.left;if(!a.visible){$container.css('opacity',d).hide()}}if(a.options.width==='auto'){styles.width=a.el.outerWidth()+'px'}$container.css(styles)},enableKillerFn:function(){var a=this;$(document).on('click.autocomplete',a.killerFn)},disableKillerFn:function(){var a=this;$(document).off('click.autocomplete',a.killerFn)},killSuggestions:function(){var a=this;a.stopKillSuggestions();a.intervalId=window.setInterval(function(){if(a.visible){if(!a.options.preserveInput){a.el.val(a.currentValue)}a.hide()}a.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var a=this,valLength=a.el.val().length,selectionStart=a.element.selectionStart,range;if(typeof selectionStart==='number'){return selectionStart===valLength}if(document.selection){range=document.selection.createRange();range.moveStart('character',-valLength);return valLength===range.text.length}return true},onKeyPress:function(e){var a=this;if(!a.disabled&&!a.visible&&e.which===keys.DOWN&&a.currentValue){a.suggest();return}if(a.disabled||!a.visible){return}switch(e.which){case keys.ESC:a.el.val(a.currentValue);a.hide();break;case keys.RIGHT:if(a.hint&&a.options.onHint&&a.isCursorAtEnd()){a.selectHint();break}return;case keys.TAB:if(a.hint&&a.options.onHint){a.selectHint();return}if(a.selectedIndex===-1){a.hide();return}a.select(a.selectedIndex);if(a.options.tabDisabled===false){return}break;case keys.RETURN:if(a.selectedIndex===-1){a.hide();return}a.select(a.selectedIndex);break;case keys.UP:a.moveUp();break;case keys.DOWN:a.moveDown();break;default:return}e.stopImmediatePropagation();e.preventDefault()},onKeyUp:function(e){var a=this;if(a.disabled){return}switch(e.which){case keys.UP:case keys.DOWN:return}clearInterval(a.onChangeInterval);if(a.currentValue!==a.el.val()){a.findBestHint();if(a.options.deferRequestBy>0){a.onChangeInterval=setInterval(function(){a.onValueChange()},a.options.deferRequestBy)}else{a.onValueChange()}}},onValueChange:function(){var a=this,options=a.options,value=a.el.val(),query=a.getQuery(value);if(a.selection&&a.currentValue!==query){a.selection=null;(options.onInvalidateSelection||$.noop).call(a.element)}clearInterval(a.onChangeInterval);a.currentValue=value;a.selectedIndex=-1;if(options.triggerSelectOnValidInput&&a.isExactMatch(query)){a.select(0);return}if(query.length<options.minChars){a.hide()}else{a.getSuggestions(query)}},isExactMatch:function(a){var b=this.suggestions;return(b.length===1&&b[0].value.toLowerCase()===a.toLowerCase())},getQuery:function(a){var b=this.options.delimiter,parts;if(!b){return a}parts=a.split(b);return $.trim(parts[parts.length-1])},getSuggestionsLocal:function(b){var c=this,options=c.options,queryLowerCase=b.toLowerCase(),filter=options.lookupFilter,limit=parseInt(options.lookupLimit,10),data;data={suggestions:$.grep(options.lookup,function(a){return filter(a,b,queryLowerCase)})};if(limit&&data.suggestions.length>limit){data.suggestions=data.suggestions.slice(0,limit)}return data},getSuggestions:function(q){var d,that=this,options=that.options,serviceUrl=options.serviceUrl,params,cacheKey,ajaxSettings;options.params[options.paramName]=q;params=options.ignoreParams?null:options.params;if(options.onSearchStart.call(that.element,options.params)===false){return}if($.isFunction(options.lookup)){options.lookup(q,function(a){that.suggestions=a.suggestions;that.suggest();options.onSearchComplete.call(that.element,q,a.suggestions)});return}if(that.isLocal){d=that.getSuggestionsLocal(q)}else{if($.isFunction(serviceUrl)){serviceUrl=serviceUrl.call(that.element,q)}cacheKey=serviceUrl+'?'+$.param(params||{});d=that.cachedResponse[cacheKey]}if(d&&$.isArray(d.suggestions)){that.suggestions=d.suggestions;that.suggest();options.onSearchComplete.call(that.element,q,d.suggestions)}else if(!that.isBadQuery(q)){that.abortAjax();ajaxSettings={url:serviceUrl,data:params,type:options.type,dataType:options.dataType};$.extend(ajaxSettings,options.ajaxSettings);that.currentRequest=$.ajax(ajaxSettings).done(function(a){var b;that.currentRequest=null;b=options.transformResult(a,q);that.processResponse(b,q,cacheKey);options.onSearchComplete.call(that.element,q,b.suggestions)}).fail(function(a,b,c){options.onSearchError.call(that.element,q,a,b,c)})}else{options.onSearchComplete.call(that.element,q,[])}},isBadQuery:function(q){if(!this.options.preventBadQueries){return false}var a=this.badQueries,i=a.length;while(i--){if(q.indexOf(a[i])===0){return true}}return false},hide:function(){var a=this,container=$(a.suggestionsContainer);if($.isFunction(a.options.onHide)&&a.visible){a.options.onHide.call(a.element,container)}a.visible=false;a.selectedIndex=-1;clearInterval(a.onChangeInterval);$(a.suggestionsContainer).hide();a.signalHint(null)},suggest:function(){if(!this.suggestions.length){if(this.options.showNoSuggestionNotice){this.noSuggestions()}else{this.hide()}return}var d=this,options=d.options,groupBy=options.groupBy,formatResult=options.formatResult,value=d.getQuery(d.currentValue),className=d.classes.suggestion,classSelected=d.classes.selected,container=$(d.suggestionsContainer),noSuggestionsContainer=$(d.noSuggestionsContainer),beforeRender=options.beforeRender,html='',category,formatGroup=function(a,b){var c=a.data[groupBy];if(category===c){return''}category=c;return'<div class="autocomplete-group"><strong>'+category+'</strong></div>'};if(options.triggerSelectOnValidInput&&d.isExactMatch(value)){d.select(0);return}$.each(d.suggestions,function(i,a){if(groupBy){html+=formatGroup(a,value,i)}html+='<div class="'+className+'" data-index="'+i+'">'+formatResult(a,value,i)+'</div>'});this.adjustContainerWidth();noSuggestionsContainer.detach();container.html(html);if($.isFunction(beforeRender)){beforeRender.call(d.element,container,d.suggestions)}d.fixPosition();container.show();if(options.autoSelectFirst){d.selectedIndex=0;container.scrollTop(0);container.children('.'+className).first().addClass(classSelected)}d.visible=true;d.findBestHint()},noSuggestions:function(){var a=this,container=$(a.suggestionsContainer),noSuggestionsContainer=$(a.noSuggestionsContainer);this.adjustContainerWidth();noSuggestionsContainer.detach();container.empty();container.append(noSuggestionsContainer);a.fixPosition();container.show();a.visible=true},adjustContainerWidth:function(){var a=this,options=a.options,width,container=$(a.suggestionsContainer);if(options.width==='auto'){width=a.el.outerWidth();container.css('width',width>0?width:300)}},findBestHint:function(){var c=this,value=c.el.val().toLowerCase(),bestMatch=null;if(!value){return}$.each(c.suggestions,function(i,a){var b=a.value.toLowerCase().indexOf(value)===0;if(b){bestMatch=a}return!b});c.signalHint(bestMatch)},signalHint:function(a){var b='',that=this;if(a){b=that.currentValue+a.value.substr(that.currentValue.length)}if(that.hintValue!==b){that.hintValue=b;that.hint=a;(this.options.onHint||$.noop)(b)}},verifySuggestionsFormat:function(b){if(b.length&&typeof b[0]==='string'){return $.map(b,function(a){return{value:a,data:null}})}return b},validateOrientation:function(a,b){a=$.trim(a||'').toLowerCase();if($.inArray(a,['auto','bottom','top'])===-1){a=b}return a},processResponse:function(a,b,c){var d=this,options=d.options;a.suggestions=d.verifySuggestionsFormat(a.suggestions);if(!options.noCache){d.cachedResponse[c]=a;if(options.preventBadQueries&&!a.suggestions.length){d.badQueries.push(b)}}if(b!==d.getQuery(d.currentValue)){return}d.suggestions=a.suggestions;d.suggest()},activate:function(a){var b=this,activeItem,selected=b.classes.selected,container=$(b.suggestionsContainer),children=container.find('.'+b.classes.suggestion);container.find('.'+selected).removeClass(selected);b.selectedIndex=a;if(b.selectedIndex!==-1&&children.length>b.selectedIndex){activeItem=children.get(b.selectedIndex);$(activeItem).addClass(selected);return activeItem}return null},selectHint:function(){var a=this,i=$.inArray(a.hint,a.suggestions);a.select(i)},select:function(i){var a=this;a.hide();a.onSelect(i);a.disableKillerFn()},moveUp:function(){var a=this;if(a.selectedIndex===-1){return}if(a.selectedIndex===0){$(a.suggestionsContainer).children().first().removeClass(a.classes.selected);a.selectedIndex=-1;a.el.val(a.currentValue);a.findBestHint();return}a.adjustScroll(a.selectedIndex-1)},moveDown:function(){var a=this;if(a.selectedIndex===(a.suggestions.length-1)){return}a.adjustScroll(a.selectedIndex+1)},adjustScroll:function(a){var b=this,activeItem=b.activate(a);if(!activeItem){return}var c,upperBound,lowerBound,heightDelta=$(activeItem).outerHeight();c=activeItem.offsetTop;upperBound=$(b.suggestionsContainer).scrollTop();lowerBound=upperBound+b.options.maxHeight-heightDelta;if(c<upperBound){$(b.suggestionsContainer).scrollTop(c)}else if(c>lowerBound){$(b.suggestionsContainer).scrollTop(c-b.options.maxHeight+heightDelta)}if(!b.options.preserveInput){b.el.val(b.getValue(b.suggestions[a].value))}b.signalHint(null)},onSelect:function(a){var b=this,onSelectCallback=b.options.onSelect,suggestion=b.suggestions[a];b.currentValue=b.getValue(suggestion.value);if(b.currentValue!==b.el.val()&&!b.options.preserveInput){b.el.val(b.currentValue)}b.signalHint(null);b.suggestions=[];b.selection=suggestion;if($.isFunction(onSelectCallback)){onSelectCallback.call(b.element,suggestion)}},getValue:function(a){var b=this,delimiter=b.options.delimiter,currentValue,parts;if(!delimiter){return a}currentValue=b.currentValue;parts=currentValue.split(delimiter);if(parts.length===1){return a}return currentValue.substr(0,currentValue.length-parts[parts.length-1].length)+a},dispose:function(){var a=this;a.el.off('.autocomplete').removeData('autocomplete');a.disableKillerFn();$(window).off('resize.autocomplete',a.fixPositionCapture);$(a.suggestionsContainer).remove()}};$.fn.autocomplete=$.fn.devbridgeAutocomplete=function(b,c){var d='autocomplete';if(!arguments.length){return this.first().data(d)}return this.each(function(){var a=$(this),instance=a.data(d);if(typeof b==='string'){if(instance&&typeof instance[b]==='function'){instance[b](c)}}else{if(instance&&instance.dispose){instance.dispose()}instance=new Autocomplete(this,b);a.data(d,instance)}})}}));
