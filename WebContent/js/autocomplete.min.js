$(function(){function e(e){if(e.files&&e.files[0]){var n=new FileReader;n.onload=function(e){$("#previewImage").attr("src",e.target.result)},n.readAsDataURL(e.files[0])}}function n(e){var n,l,a,s;if(void 0==e.elements["ingredients[]"].length)n=e.elements["ingredients[]"].value,l=e.elements["quantites[]"].value,a=e.elements["mesures[]"].value;else for(tmpI=e.elements["ingredients[]"],tmpQ=e.elements["quantites[]"],tmpM=e.elements["mesures[]"],n=tmpI[0].value+"",l=tmpQ[0].value+"",a=tmpM[0].value+"",i=1;i<tmpI.length;i++)n+=","+tmpI[i].value,l+=","+tmpQ[i].value,a+=","+tmpM[i].value;if(void 0==e.elements["etapes[]"].length)s=e.elements["etapes[]"].value;else for(tmp=e.elements["etapes[]"],s=tmp[0].value,i=1;i<tmp.length;i++)s+="@"+tmp[i].value;if(console.log(e.titre.value),console.log(n),console.log(l),console.log(a),console.log(s),console.log("before Creer"),""==e.titre.value||""==n||""==l||""==a||""==s)return void alert("Il manque des informations");var r=new RegExp("-");return r.test(l)?(console.log("no"),void alert("Vous devez rentre une quantite positive")):o?void t(e,e.titre.value,n,l,a,s):(console.log("photo"),void alert("Vous devez rentre une photo"))}function t(e,n,t,o,l,i){var a=new FormData;console.log(e.uploadInput.files[0]),a.append("file",e.uploadInput.files[0]),a.append("titre",n),a.append("cle",getCookie(C_NAME_KEY)),a.append("ingredients",t),a.append("quantites",o),a.append("mesures",l),a.append("preparation",i),console.log("Envoie"),jQuery.ajax({url:"recette/publier",data:a,cache:!1,contentType:!1,processData:!1,type:"POST",success:function(e){JSON.stringify(e);return void 0==e.erreur?(console.log("OK recette cree"),console.log(e),void(window.location.href="accueil.html")):void(40==e.erreur?(alert("Votre session a expirÃ©"),deconnexion()):alert("Erreur: "+e.message))},error:function(e,n,t){console.log(e),console.log(n),console.log(t),console.log("soucis")}})}var o=!1;if($("#uploadInput").change(function(){e(this),o=!0}),$(document).on("click",".btn-add-ingredient",function(e){e.preventDefault();var n=$(".controls-ingredient:first"),t=$(this).parents(".entry-ingredient:first"),o=$(t.clone()).appendTo(n);o.find("input").val(""),n.find(".entry-ingredient:not(:last) .btn-add-ingredient").removeClass("btn-add-ingredient").addClass("btn-remove-ingredient").removeClass("btn-success").addClass("btn-danger").html('<span class="glyphicon glyphicon-minus"></span>'),$(".autocomplete").autocomplete({serviceUrl:"ingredients/autocomplete",noCache:!0,maxHeight:100,onSelect:function(e){var n="<p>"+e.value+"</p>";$("#choix").append(n)}})}).on("click",".btn-remove-ingredient",function(e){return $(this).parents(".entry-ingredient:first").remove(),e.preventDefault(),!1}),$(document).on("click",".btn-add-etapes",function(e){e.preventDefault();var n=$(".controls-etapes"),t=$(this).parents(".entry-etapes:first"),o=$(t.clone()).appendTo(n);o.find("textarea").val(""),n.find(".entry-etapes:not(:last) .btn-add-etapes").removeClass("btn-add-etapes").addClass("btn-remove-etapes").removeClass("btn-success").addClass("btn-danger").html('<span class="glyphicon glyphicon-minus"></span>')}).on("click",".btn-remove-etapes",function(e){return $(this).parents(".entry-etapes:first").remove(),e.preventDefault(),!1}),$(".autocomplete").autocomplete({serviceUrl:"ingredients/autocomplete",noCache:!0,maxHeight:100,onSelect:function(e){}}),$("#formulaire_recette").on("submit",function(){n(this)}),1===(bool=isConnected()))loadNavbarConnected(),console.log("connecte");else{if(-1!==bool)return console.log("Invalide"),void(window.location.href="connexion.html");console.log("Lutilisateur ne devrait pas etre la"),window.location.href="accueil.html"}});