function Auteur(e,t){this.idAuteur=e,this.loginAuteur=t}function Ingredient(e,t,r){this.nomIngredient=e,this.quantite=t,this.mesure=r}function Note(e,t){this.moyenne=e,this.nbNotes=t}function Recette(e,t,r,n,o,i,s,a){this.id=e,this.auteur=t,this.titre=r,this.photo=s,this.ingredients=n,this.preparation=o,this.note=i,this.photo=s,this.prix=a}function Note(e,t,r){this.moyenne=e,this.nbNotes=t,this.usersNotes=r}function NoteUser(e,t){this.idUser=e,this.userNote=t}function isNumber(e){return!isNaN(e-0)}var __slice=[].slice;!function(e,t){var r;return r=function(){function t(t,r){var n,o,i,s=this;this.options=e.extend({},this.defaults,r),this.$el=t,i=this.defaults;for(n in i)o=i[n],null!=this.$el.data(n)&&(this.options[n]=this.$el.data(n));this.createStars(),this.syncRating(),this.$el.on("mouseover.starrr","span",function(e){return s.syncRating(s.$el.find("span").index(e.currentTarget)+1)}),this.$el.on("mouseout.starrr",function(){return s.syncRating()}),this.$el.on("click.starrr","span",function(e){return s.setRating(s.$el.find("span").index(e.currentTarget)+1)}),this.$el.on("starrr:change",this.options.change)}return t.prototype.defaults={rating:void 0,numStars:5,change:function(t,r){var n=e.urlParam("idRecette");e.ajax({url:"recette/noter",type:"POST",data:"cle="+getCookie(C_NAME_KEY)+"&idRecette="+n+"&note="+r,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",success:function(t){console.log("Notation reussie"),console.log(JSON.stringify(t));var r=JSON.parse(JSON.stringify(t),Note.revival);void 0==r.erreur?(e("#noter-recette").html("<span style:'text-align:center'>Vous avez noté cette recette</span>"),e("#note").html("<span>"+r.moyenne.toFixed(2)+"/5 ("+r.nbNotes+" vote(s))</span>")):40==r.erreur?(alert("Votre session a expiré"),deconnexion()):alert("Erreur: "+r.message)},error:function(e,t,r){console.log("Bug"),console.log(e),alert("Erreur Ajax")}})}},t.prototype.createStars=function(){var e,t,r;for(r=[],e=1,t=this.options.numStars;t>=1?t>=e:e>=t;t>=1?e++:e--)r.push(this.$el.append("<span class='glyphicon .glyphicon-star-empty'></span>"));return r},t.prototype.setRating=function(e){return this.options.rating===e&&(e=void 0),this.options.rating=e,this.syncRating(),this.$el.trigger("starrr:change",e)},t.prototype.syncRating=function(e){var t,r,n,o;if(e||(e=this.options.rating),e)for(t=r=0,o=e-1;o>=0?o>=r:r>=o;t=o>=0?++r:--r)this.$el.find("span").eq(t).removeClass("glyphicon-star-empty").addClass("glyphicon-star");if(e&&5>e)for(t=n=e;4>=e?4>=n:n>=4;t=4>=e?++n:--n)this.$el.find("span").eq(t).removeClass("glyphicon-star").addClass("glyphicon-star-empty");return e?void 0:this.$el.find("span").removeClass("glyphicon-star").addClass("glyphicon-star-empty")},t}(),e.fn.extend({starrr:function(){var t,n;return n=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],this.each(function(){var o;return o=e(this).data("star-rating"),o||e(this).data("star-rating",o=new r(e(this),n)),"string"==typeof n?o[n].apply(o,t):void 0})}})}(window.jQuery,window),$(function(){return $(".starrr").starrr()}),Note.revival=function(e,t){if(0==e.length){var r;return void 0==t.Erreur||0==t.Erreur?r=new Note(t.moyenne,t.nbNotes,t.usersNotes):(r=new Object,r.Erreur=t.Erreur,r)}return t},Recette.revival=function(e,t){if(0==e.length){var r;return void 0==t.Erreur||0==t.Erreur?r=new Recette(t._id,t.auteur,t.titre,t.ingredients,t.preparation,t.note,t.photo,t.prix.toFixed(2)):(r=new Object,r.Erreur=t.Erreur),r}if(isNumber(e)&&void 0!=t.nomIngredient){var n=new Ingredient(t.nomIngredient,t.quantite,t.mesure);return n}if(isNumber(e)&&void 0!=t.idUser){var o=new NoteUser(t.idUser,t.userNote);return o}if("auteur"==e){var i;return i=new Auteur(t.idAuteur,t.loginAuteur)}if("note"==e){var s;return s=new Note(t.moyenne,t.nbNotes,t.usersNotes)}return t},Recette.traiteReponseJSON=function(e){var t=JSON.parse(JSON.stringify(e),Recette.revival);if(void 0==t.erreur){$("#titre-recette").html("<span>"+t.titre+"</span>"),$("#photo-recette").html("<center><img class='img-responsive' id='recettePhoto' src='../images/"+t.photo+".png' alt='Recette Picture'/></center>"),$("#nom-auteur-recette").html("<a href='profile.html?login="+t.auteur.loginAuteur+"'>"+t.auteur.loginAuteur+"</a>"),$("#photo-auteur").html("<center><img class='img-responsive' id='profilPicture' src='../images/profil/"+t.auteur.loginAuteur+".png' alt='Profil Picture' onerror=\"this.onerror=null;this.src='../images/profil/genericImage.png'\"/></center>"),$("#note").html("<span>"+t.note.moyenne.toFixed(2)+"/5 ("+t.note.nbNotes+" votes)</span>");var r,n=t.note.usersNotes,o=!1,i=getCookie(C_NAME_ID);for(r=0;r<n.length;r++)if(n[r].idUser==i){o=!0;break}1===isConnected()&&getCookie(C_NAME_LOGIN)!=t.auteur.loginAuteur?(console.log("cookielogin="+getCookie(C_NAME_LOGIN)+" loginAuteur="+t.auteur.loginAuteur),0==o?($("#notez").html("Notez cette recette:"),$("#stars").show()):($("#stars").hide(),$("#notez").html("<p>Vous avez donné "+n[r].userNote+" étoile(s) à cette recette.</p>"))):$("#stars").hide();var s="<ul>";for(r=0;r<t.ingredients.length;r++){var a=t.ingredients[r];s+="<li><span class='txt-size-25'>"+a.nomIngredient+": "+a.quantite+" "+a.mesure+"</span></li>"}s+="</ul>",$("#ingr").html(s),$("#prix").html('<img class="loading" src="images/loading_icon.gif" width="110" height="72">');var u="<ul>";for(r=0;r<t.preparation.length;r++){var c=t.preparation[r];u+="<li><span class='txt-size-25'>"+c+"</span></li>"}u+="</ul>",$("#prep").html(u)}else alert(t)},Recette.afficherPrix=function(e){console.log(JSON.stringify(e));var t=JSON.parse(JSON.stringify(e));void 0!=t.erreur&&666==t.erreur?$.ajax({url:"recette/prix",type:"GET",data:"idRecette="+idRecette+cle,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",success:Recette.afficherPrix,error:function(e,t,r){console.log("Bug"),console.log(e)}}):(console.log(t.success),$("#prix").html("<span class='txt-size-35'>Prix estimé: </span><span class='txt-size-25'>"+t.success+"€</span>"))},$.urlParam=function(e){var t=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null==t?null:t[1]||0},$(document).ready(function(){if($("#hearts").on("starrr:change",function(e,t){$("#count").html(t)}),1===(bool=isConnected()))loadNavbarConnected(),console.log("connecte");else{if(-1!==bool)return console.log("Invalide"),void(window.location.href="connexion.html");loadNavbarDisconnected(),console.log("deconnecte")}var e=$.urlParam("idRecette"),t="";void 0!=getCookie(C_NAME_KEY)&&(t="&cle="+getCookie(C_NAME_KEY)),$.ajax({url:"recette/afficher",type:"GET",data:"idRecette="+e+t,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",success:Recette.traiteReponseJSON,error:function(e,t,r){console.log("Bug"),console.log(e),alert("Erreur Ajax")}}),$.ajax({url:"recette/prix",type:"GET",data:"idRecette="+e+t,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",success:Recette.afficherPrix,error:function(e,t,r){console.log("Bug"),console.log(e)}})});