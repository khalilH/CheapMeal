function Auteur(a,b){this.idAuteur=a,this.loginAuteur=b}function Ingredient(a,b,c){this.nomIngredient=a,this.quantite=b,this.mesure=c}function Note(a,b){this.moyenne=a,this.nbNotes=b}function Recette(a,b,c,d,e,f,g,h){this.id=a,this.auteur=b,this.titre=c,this.photo=g,this.ingredients=d,this.preparation=e,this.note=f,this.photo=g,this.prix=h}function Note(a,b,c){this.moyenne=a,this.nbNotes=b,this.usersNotes=c}function NoteUser(a,b){this.idUser=a,this.userNote=b}function isNumber(a){return!isNaN(a-0)}var __slice=[].slice;!function(a,b){var c;return c=function(){function b(b,c){var d,e,f,g=this;this.options=a.extend({},this.defaults,c),this.$el=b,f=this.defaults;for(d in f)e=f[d],null!=this.$el.data(d)&&(this.options[d]=this.$el.data(d));this.createStars(),this.syncRating(),this.$el.on("mouseover.starrr","span",function(a){return g.syncRating(g.$el.find("span").index(a.currentTarget)+1)}),this.$el.on("mouseout.starrr",function(){return g.syncRating()}),this.$el.on("click.starrr","span",function(a){return g.setRating(g.$el.find("span").index(a.currentTarget)+1)}),this.$el.on("starrr:change",this.options.change)}return b.prototype.defaults={rating:void 0,numStars:5,change:function(b,c){var d=a.urlParam("idRecette");a.ajax({url:"recette/noter",type:"POST",data:"cle="+getCookie(C_NAME_KEY)+"&idRecette="+d+"&note="+c,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",success:function(b){console.log("Notation reussie"),console.log(JSON.stringify(b));var c=JSON.parse(JSON.stringify(b),Note.revival);void 0==c.erreur?(a("#noter-recette").html("<span style:'text-align:center'>Vous avez noté cette recette</span>"),a("#note").html("<span>"+c.moyenne.toFixed(2)+"/5 ("+c.nbNotes+" vote(s))</span>")):40==c.erreur?(alert("Votre session a expiré"),deconnexion()):alert("Erreur: "+c.message)},error:function(a,b,c){console.log("Bug"),console.log(a),alert("Erreur Ajax")}})}},b.prototype.createStars=function(){var a,b,c;for(c=[],a=1,b=this.options.numStars;1<=b?a<=b:a>=b;1<=b?a++:a--)c.push(this.$el.append("<span class='glyphicon .glyphicon-star-empty'></span>"));return c},b.prototype.setRating=function(a){return this.options.rating===a&&(a=void 0),this.options.rating=a,this.syncRating(),this.$el.trigger("starrr:change",a)},b.prototype.syncRating=function(a){var b,c,d,e;if(a||(a=this.options.rating),a)for(b=c=0,e=a-1;0<=e?c<=e:c>=e;b=0<=e?++c:--c)this.$el.find("span").eq(b).removeClass("glyphicon-star-empty").addClass("glyphicon-star");if(a&&a<5)for(b=d=a;a<=4?d<=4:d>=4;b=a<=4?++d:--d)this.$el.find("span").eq(b).removeClass("glyphicon-star").addClass("glyphicon-star-empty");if(!a)return this.$el.find("span").removeClass("glyphicon-star").addClass("glyphicon-star-empty")},b}(),a.fn.extend({starrr:function(){var b,d;return d=arguments[0],b=2<=arguments.length?__slice.call(arguments,1):[],this.each(function(){var e;if(e=a(this).data("star-rating"),e||a(this).data("star-rating",e=new c(a(this),d)),"string"==typeof d)return e[d].apply(e,b)})}})}(window.jQuery,window),$(function(){return $(".starrr").starrr()}),Note.revival=function(a,b){if(0==a.length){var c;return void 0==b.Erreur||0==b.Erreur?c=new Note(b.moyenne,b.nbNotes,b.usersNotes):(c=new Object,c.Erreur=b.Erreur,c)}return b},Recette.revival=function(a,b){if(0==a.length){var c;return void 0==b.Erreur||0==b.Erreur?c=new Recette(b._id,b.auteur,b.titre,b.ingredients,b.preparation,b.note,b.photo,b.prix.toFixed(2)):(c=new Object,c.Erreur=b.Erreur),c}if(isNumber(a)&&void 0!=b.nomIngredient){var d=new Ingredient(b.nomIngredient,b.quantite,b.mesure);return d}if(isNumber(a)&&void 0!=b.idUser){var e=new NoteUser(b.idUser,b.userNote);return e}if("auteur"==a){var f;return f=new Auteur(b.idAuteur,b.loginAuteur)}if("note"==a){var g;return g=new Note(b.moyenne,b.nbNotes,b.usersNotes)}return b},Recette.traiteReponseJSON=function(a){var b=JSON.parse(JSON.stringify(a),Recette.revival);if(void 0==b.erreur){$("#titre-recette").html("<span>"+b.titre+"</span>"),$("#photo-recette").html("<center><img class='img-responsive' id='recettePhoto' src='../images/"+b.photo+".png' alt='Recette Picture'/></center>"),$("#nom-auteur-recette").html("<a href='profile.html?login="+b.auteur.loginAuteur+"'>"+b.auteur.loginAuteur+"</a>"),$("#photo-auteur").html("<center><img class='img-responsive' id='profilPicture' src='../images/profil/"+b.auteur.loginAuteur+".png' alt='Profil Picture' onerror=\"this.onerror=null;this.src='../images/profil/genericImage.png'\"/></center>"),$("#note").html("<span>"+b.note.moyenne.toFixed(2)+"/5 ("+b.note.nbNotes+" votes)</span>");var d,c=b.note.usersNotes,e=!1,f=getCookie(C_NAME_ID);for(d=0;d<c.length;d++)if(c[d].idUser==f){e=!0;break}1===isConnected()&&getCookie(C_NAME_LOGIN)!=b.auteur.loginAuteur?(console.log("cookielogin="+getCookie(C_NAME_LOGIN)+" loginAuteur="+b.auteur.loginAuteur),0==e?($("#notez").html("Notez cette recette:"),$("#stars").show()):($("#stars").hide(),$("#notez").html("<p>Vous avez donné "+c[d].userNote+" étoile(s) à cette recette.</p>"))):$("#stars").hide();var g="<ul>";for(d=0;d<b.ingredients.length;d++){var h=b.ingredients[d];g+="<li><span class='txt-size-25'>"+h.nomIngredient+": "+h.quantite+" "+h.mesure+"</span></li>"}g+="</ul>",$("#ingr").html(g),$("#prix").html('<img class="loading" src="images/loading_icon.gif" width="110" height="72">');var i="<ul>";for(d=0;d<b.preparation.length;d++){var j=b.preparation[d];i+="<li><span class='txt-size-25'>"+j+"</span></li>"}i+="</ul>",$("#prep").html(i)}else alert(b)},Recette.afficherPrix=function(a){console.log(JSON.stringify(a));var b=JSON.parse(JSON.stringify(a));void 0!=b.erreur&&666==b.erreur?$.ajax({url:"recette/prix",type:"GET",data:"idRecette="+idRecette+cle,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",success:Recette.afficherPrix,error:function(a,b,c){console.log("Bug"),console.log(a)}}):(console.log(b.success),$("#prix").html("<span class='txt-size-35'>Prix estimé: </span><span class='txt-size-25'>"+b.success+"€</span>"))},$.urlParam=function(a){console.log("trying to get val");var b=new RegExp("[?&]"+a+"=([^&#]*)").exec(window.location.href);return null==b?null:b[1]||0};var idRecette=$.urlParam("idRecette"),cle="";$(document).ready(function(){if($("#hearts").on("starrr:change",function(a,b){$("#count").html(b)}),1===(bool=isConnected()))loadNavbarConnected(),console.log("connecte");else{if(bool!==-1)return console.log("Invalide"),void(window.location.href="connexion.html");loadNavbarDisconnected(),console.log("deconnecte")}void 0!=getCookie(C_NAME_KEY)&&(cle="&cle="+getCookie(C_NAME_KEY)),$.ajax({url:"recette/afficher",type:"GET",data:"idRecette="+idRecette+cle,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",success:Recette.traiteReponseJSON,error:function(a,b,c){console.log("Bug"),console.log(a),alert("Erreur Ajax")}}),$.ajax({url:"recette/prix",type:"GET",data:"idRecette="+idRecette+cle,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",success:Recette.afficherPrix,error:function(a,b,c){console.log("Bug"),console.log(a)}})});